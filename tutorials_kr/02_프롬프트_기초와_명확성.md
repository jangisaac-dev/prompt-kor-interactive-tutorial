Thumbnail: A professional developer sitting at a desk with two floating chat bubbles labeled 'Ambiguous' and 'Clear', with a robotic lobster (Claude) pointing towards the 'Clear' bubble. Cinematic lighting, tech workspace background.

# Anthropic Prompt Engineering 101 - Part 2: 프롬프트의 기초와 명확성

"만약 당신의 친구에게 요청했을 때 헷갈려 할 내용이라면, Claude도 똑같이 헷갈려 할 것입니다."

프롬프트 엔지니어링의 세계에 오신 것을 환영합니다. 지난 1부에서는 환경 설정과 API 키 발급이라는 기초 공사를 마쳤습니다. 이제 본격적으로 Claude라는 거대한 지성체와 대화하는 법을 배울 차례입니다.

많은 사람들이 AI에게 복잡한 마법의 주문을 외워야 한다고 생각하지만, 사실 가장 중요한 원칙은 **'명확성(Clarity)'**입니다. 모호한 지시는 모호한 결과를 낳습니다. 이번 포스팅에서는 Anthropic의 Messages API 구조를 해부하고, Claude에게 명확하고 직관적으로 명령을 내리는 방법을 깊이 있게 다룹니다.

## 1. Messages API의 구조와 '금기 사항'

Claude와 소통하기 위해서는 먼저 그들의 언어 규칙인 **Messages API**를 이해해야 합니다. 이 구조는 단순히 텍스트를 던지는 것이 아니라, 대화의 '역할(Role)'을 부여하여 맥락을 형성합니다.

### 역할(Role)의 정의

Messages API는 크게 세 가지 구성 요소로 이루어집니다.

| 구성 요소 | 역할 | 설명 |
| --- | --- | --- |
| **system** | 시스템 | 대화 전체를 관통하는 규칙, 설정, 맥락을 정의합니다. (선택 사항) |
| **user** | 사용자 | 질문을 하거나 명령을 내리는 주체입니다. 대화의 시작은 항상 `user`가 엽니다. |
| **assistant** | AI (Claude) | 사용자의 입력에 응답하는 주체입니다. |

### 주의: 가장 많이 저지르는 '형식 오류'

Messages API를 처음 사용할 때 개발자들이 가장 자주 마주하는 에러들이 있습니다. 규칙을 지키지 않으면 API는 가차 없이 400 에러를 반환합니다.

#### ❌ 잘못된 형식 1: 문자열만 보낸 경우
`messages` 리스트 안에는 반드시 `role`과 `content` 키를 가진 딕셔너리(객체)가 들어가야 합니다.
```python
# 에러 발생!
messages=["안녕하세요, Claude!"] 
```

#### ❌ 잘못된 형식 2: User가 연속으로 나타나는 경우
Claude API의 핵심 규칙은 **'교대 패턴(Alternating Pattern)'**입니다. `user` 다음에는 반드시 `assistant`가 와야 합니다.
```python
# 에러 발생! (User -> User)
messages=[
    {"role": "user", "content": "오늘 날씨 어때?"},
    {"role": "user", "content": "아, 그리고 우산 챙겨야 할까?"}
]
```

#### ✅ 올바른 형식
대화의 흐름을 리스트로 관리하며, 반드시 역할을 교차해야 합니다.
```json
{
  "system": "당신은 도움이 되는 AI 비서입니다.",
  "messages": [
    {
      "role": "user",
      "content": "안녕하세요, 오늘 날씨가 어떤가요?"
    },
    {
      "role": "assistant",
      "content": "죄송합니다만, 저는 실시간 날씨 정보에 접근할 수 없습니다."
    },
    {
      "role": "user",
      "content": "그럼 비가 올 때 주의할 점을 알려주세요."
    }
  ]
}
```

## 2. 명확성의 황금률: 직접적으로 말하기

프롬프트 작성의 황금률은 간단합니다. **"명확하고 직접적으로 말하라(Be Clear & Direct)"**입니다. Claude는 행간을 읽거나 눈치를 보지 않습니다. 요청받은 그대로를 수행하려고 노력합니다.

### 예시: 서론 생략하기 (Skip the Preamble)

우리는 보통 "하이쿠를 써줘"라고 말합니다. 그러면 Claude는 친절한 비서처럼 "물론입니다! 여기 로봇에 대한 하이쿠입니다:"라는 서론(Preamble)을 붙입니다. 하지만 자동화 파이프라인이나 특정 UI에 결과를 바로 넣어야 한다면 이 서론은 불필요한 노이즈가 됩니다.

*   **Before (모호한 요청):** 
    *   프롬프트: "로봇에 대한 하이쿠를 써줘."
    *   Claude의 답변: "물론이죠! 로봇에 대한 하이쿠는 다음과 같습니다. \n\n금속 심장 위\n전기 신호 흐르네\n꿈꾸는 기계"
*   **After (명확한 요청):**
    *   프롬프트: "로봇에 대한 하이쿠를 써줘. **서론과 인사는 생략하고(Skip the preamble) 오직 시 내용만 출력해.**"
    *   Claude의 답변: "금속 심장 위\n전기 신호 흐르네\n꿈꾸는 기계"

이 작은 차이가 코드의 복잡성을 줄여줍니다. 정규표현식으로 서론을 잘라낼 필요가 없어지니까요.

## 3. 실전 시뮬레이션: Claude 길들이기

이제 배운 내용을 코드로 확인해 보겠습니다.

> ⚠️ 아래 내용은 실제 실행 결과가 아닌 텍스트 시뮬레이션입니다. 실제 출력은 모델 버전에 따라 미세하게 다를 수 있습니다.

### Exercise 2.1: 시스템 프롬프트(System Prompt)의 위력

`system` 파라미터를 사용하여 Claude의 '세계관'을 설정합니다. 사용자가 어떤 언어로 물어도 무조건 스페인어로 답하게 강제해 봅시다.

```python
import anthropic

client = anthropic.Anthropic()

response = client.messages.create(
    model="claude-3-5-sonnet-20241022",
    max_tokens=1000,
    system="너는 모든 질문에 오직 스페인어로만 대답하는 전문 번역가야.",
    messages=[
        {"role": "user", "content": "How are you today?"}
    ]
)

print(response.content[0].text)
```

**예상 출력:**
```text
¡Hola! Estoy muy bien, gracias por preguntar. ¿En qué puedo ayudarte hoy?
```
System Prompt는 대화 내내 유지되는 '헌법'과 같습니다. 개별 메시지에서 지시하는 것보다 훨씬 강력한 구속력을 가집니다.

### Exercise 2.2: 단답형 강제와 max_tokens의 진실

Claude가 장황하게 설명하는 것을 막고 싶을 때, 우리는 `max_tokens`를 줄이려는 유혹에 빠집니다. 하지만 이는 위험한 선택입니다.

```python
# max_tokens를 극단적으로 작게 설정한 경우
response = client.messages.create(
    model="claude-3-5-sonnet-20241022",
    max_tokens=5, # '하드 스톱' 발생!
    messages=[{"role": "user", "content": "피보나치 수열에 대해 설명해줘."}]
)
```

**예상 출력:**
```text
피보나치 수열은
```
`max_tokens`는 **"이 지점이 넘어가면 문장이 잘리더라도 강제로 멈춰라"**라는 **하드 스톱(Hard Stop)** 기능입니다. 답변의 길이를 조절하고 싶다면 프롬프트에 "한 문장으로 말해줘"라고 적고, `max_tokens`는 충분히 넉넉하게 주는 것이 정석입니다.

### Exercise 2.3: 긴 분량 제어하기 (The 800-Word Challenge)

반대로 Claude에게 아주 긴 답변을 요구해야 할 때도 있습니다. LLM은 기본적으로 효율성을 중시하여 답변을 요약하려는 경향이 있습니다. 이를 극복하려면 **명시적인 수치**를 제공해야 합니다.

```python
response = client.messages.create(
    model="claude-3-5-sonnet-20241022",
    max_tokens=4000,
    messages=[
        {
            "role": "user", 
            "content": "사이버펑크 서울을 배경으로 한 단편 소설을 써줘. **최소 800단어 이상의 분량으로 상세하게 작성해줘.**"
        }
    ]
)
```
단순히 "길게 써줘"라고 하면 Claude는 300~400단어 수준에서 멈출 수 있습니다. 구체적인 단어 수나 문장 수를 지정하는 것이 긴 글 작성을 유도하는 핵심 팁입니다.

## 4. 심화 가이드: System Prompt vs User Message

초보자가 가장 헷갈려 하는 부분이 "지시사항을 시스템에 넣어야 하나, 유저 메시지에 넣어야 하나?"입니다.

1.  **System Prompt (전역 규칙)**: 
    *   "너는 파이썬 전문가야." (페르소나)
    *   "답변은 항상 JSON 형식으로 해." (출력 포맷)
    *   "모르는 내용은 아는 척하지 마." (작동 원칙)
2.  **User Message (가변적 작업)**:
    *   "이 코드의 버그를 찾아줘."
    *   "오늘 점심 메뉴 추천해줘."

Claude는 훈련 과정에서 **System Prompt를 User Message보다 더 높은 우선순위**로 인지하도록 설계되었습니다. 따라서 절대로 어겨서는 안 되는 규칙은 System Prompt에 배치하는 것이 훨씬 안정적입니다.

## 5. 결론

프롬프트 엔지니어링의 시작은 '컴퓨터에게 말을 거는 법'을 다시 배우는 것입니다. 친구에게 하듯 편하게 말하되, 친구보다 훨씬 더 구체적이고 명확하게 지시해야 합니다.

1.  대화는 `user`와 `assistant`가 탁구를 치듯 주고받아야 합니다. (교대 패턴)
2.  불필요한 서론을 자르고 싶다면 "서론 생략(Skip the preamble)"이라고 명시하세요.
3.  `max_tokens`로 길이를 조절하지 마세요. 그것은 단지 절단기일 뿐입니다.
4.  분량을 제어하고 싶다면 "최소 800단어"와 같이 명시적인 숫자를 사용하세요.

다음 시간에는 **Claude에게 맥락(Context)을 제공하는 방법**과 **환각(Hallucination)을 줄이는 테크닉**에 대해 알아보겠습니다.

## 6. TL;DR

- **Messages API**: `user`와 `assistant`가 번갈아 대화하며, 전체 규칙은 `system`에 정의합니다. 리스트 안에 딕셔너리 형태를 잊지 마세요.
- **명확성**: 원하는 결과값만 얻고 싶다면 "서론 생략"을 명시하세요. Claude는 말하기를 좋아하는 비서입니다.
- **분량 제어**: 짧은 답변은 프롬프트 지시로, 긴 답변은 구체적인 단어 수(최소 800단어 등)를 지정하여 유도하세요.
- **토큰 제한**: `max_tokens`는 답변이 잘릴 수 있는 최대 한계선입니다. 안전한 생성을 위해 항상 여유 있게 설정하세요.

## 7. 참고 링크

- [Anthropic Messages API Docs](https://docs.anthropic.com/en/api/messages)
- [Anthropic Prompt Engineering Guide](https://docs.anthropic.com/en/docs/prompt-engineering)

프롬프트 엔지니어링, Anthropic, Claude3, LLM, AI개발, Messages API, 파이썬, 프롬프트기초, 클로드, 인공지능작법
